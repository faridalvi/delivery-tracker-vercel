<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location Tracker Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #1a1a2e; color: #eee; min-height: 100vh; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 30px; color: #00d9ff; }
        .card { background: #16213e; border-radius: 10px; padding: 20px; margin-bottom: 20px; }
        .card h2 { color: #00d9ff; margin-bottom: 15px; font-size: 18px; }
        form { display: flex; gap: 10px; }
        input[type="text"] { flex: 1; padding: 12px; border: none; border-radius: 5px; background: #0f3460; color: #fff; }
        button { padding: 12px 25px; border: none; border-radius: 5px; background: #00d9ff; color: #1a1a2e; font-weight: bold; cursor: pointer; }
        button:hover { background: #00b8d4; }
        .link-list { margin-top: 20px; }
        .link-item { background: #0f3460; border-radius: 8px; padding: 15px; margin-bottom: 10px; }
        .link-item.received { border-left: 4px solid #00ff88; }
        .link-item.pending { border-left: 4px solid #ffaa00; }
        .link-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .link-name { font-weight: bold; font-size: 16px; }
        .status { padding: 3px 10px; border-radius: 12px; font-size: 12px; }
        .status.received { background: #00ff88; color: #000; }
        .status.pending { background: #ffaa00; color: #000; }
        .link-url { background: #1a1a2e; padding: 8px 12px; border-radius: 5px; font-family: monospace; font-size: 13px; word-break: break-all; margin: 10px 0; }
        .location-info { background: #1a1a2e; padding: 12px; border-radius: 5px; margin-top: 10px; }
        .location-info p { margin: 5px 0; font-size: 14px; }
        .location-info a { color: #00d9ff; }
        .actions { margin-top: 10px; }
        .actions a { color: #ff5555; font-size: 13px; text-decoration: none; }
        .actions a:hover { text-decoration: underline; }
        .empty { text-align: center; color: #666; padding: 40px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Location Tracker</h1>

        <div class="card">
            <h2>Create New Tracking Link</h2>
            <form action="/create_link" method="POST">
                <input type="text" name="name" placeholder="Enter a name/label for this link" required>
                <button type="submit">Generate Link</button>
            </form>
        </div>

        <div class="card">
            <h2>Tracking Links</h2>
            <div class="link-list">
                {% if locations %}
                    {% for link_id, data in locations.items() %}
                    <div class="link-item {{ data.status }}">
                        <div class="link-header">
                            <span class="link-name">{{ data.name }}</span>
                            <span class="status {{ data.status }}">{{ data.status.upper() }}</span>
                        </div>
                        <div class="link-url">{{ request.host_url }}track/{{ link_id }}</div>
                        <p style="font-size: 12px; color: #888;">Created: {{ data.created }}</p>

                        {% if data.location %}
                        <div class="location-info">
                            <p><strong>Latitude:</strong> {{ data.location.latitude }}</p>
                            <p><strong>Longitude:</strong> {{ data.location.longitude }}</p>
                            <p><strong>Accuracy:</strong> {{ data.location.accuracy }} meters</p>
                            <p><strong>Received:</strong> {{ data.location.received_at }}</p>
                            <p><strong>IP:</strong> {{ data.location.ip }}</p>
                            <p><a href="https://www.google.com/maps?q={{ data.location.latitude }},{{ data.location.longitude }}" target="_blank">View on Google Maps</a></p>
                        </div>
                        {% endif %}

                        <div class="actions">
                            <a href="/delete/{{ link_id }}">Delete</a>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="empty">No tracking links yet. Create one above!</div>
                {% endif %}
            </div>
        </div>
    </div>
</body>
</html>
